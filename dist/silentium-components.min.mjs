import{give as e,SourceAll as t,value as r,Patron as s,SourceWithPool as i,GuestCast as n,PatronOnce as l,PrivateClass as c,Source as o,sourceOf as a}from"silentium";import{HistoryNewPage as u,HistoryPoppedPage as h}from"silentium-web-api";class d{constructor(e,t){this.basePath=e,this.template=t}content(t){fetch(this.basePath+"/"+this.template).then((e=>e.text())).then((r=>{e(r,t)}))}}class p{constructor(e,t,r,s,i){this.loading=e,this.basePath=t,this.currentPage=r,this.display=s,this.pageTransport=i}routes(i){const n=i.find((e=>e.default)),l=new t;r(this.basePath,new s(l.guestKey("basePath"))),r(this.currentPage,new s(l.guestKey("currentPage"))),l.value(new s((({basePath:t,currentPage:r})=>{const s=r.replace(t,""),l=i.find((e=>e.aliases&&(e.aliases.includes(r)||e.aliases.includes(s))));if(l){const s=t+l.url;if(s!==r)return void e(s,this.currentPage)}let c=i.find((e=>{if(e.url.indexOf("*")>=0){return new RegExp(e.url.replaceAll("*",".*").replaceAll("/","/")).test(s)}return e.url.replaceAll("*","")===s}));if(!c&&n&&(c=n),!c)throw new Error("No matching route in Navigation");{const r=t.replace("/#","").replace("#","").replace(/[^/]+\.html$/,"");e(!0,this.loading),this.pageTransport.get(r,c.template).content((t=>{this.display.display(t),c.page.mounted(),e(!1,this.loading)}))}})))}}class g{constructor(e){this.selector=e}display(e){const t=document.querySelector(this.selector);t&&(t.innerHTML=e)}}var v=Object.defineProperty,w=(e,t,r)=>((e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class m{constructor(){w(this,"source");const e=location.href.replace(location.origin,"");this.source=new i(e)}give(e){return this.source.give(e),this}value(e){return this.source.value(e),e}pool(){return this.source.pool()}}class f{constructor(e,t){this.source=e;const r=document.querySelector(t);this.source.value(new s((e=>{r.value=String(e)}))),r.addEventListener("keyup",(()=>{this.give(r.value)})),r.addEventListener("change",(()=>{this.give(r.value)}))}value(e){return this.source.value(e),this}give(e){return this.source.give(e),this}pool(){return this.source.pool()}}class S{constructor(e){this.selector=e}give(e){const t=document.querySelector(this.selector);return t&&(t.style.display=e?"block":"none"),this}}class b{constructor(e){this.selector=e}give(e){const t=document.querySelector(this.selector);return t&&(t.innerText=String(e)),this}}class y{constructor(e,t){this.linkSource=e,this.basePath=t}watchClick(e,t){const r=document.querySelectorAll(e);if(!r.length)throw new Error(`Link wrapper not found for selector ${e}`);r.forEach((e=>{e.addEventListener("click",(r=>{t?e.querySelectorAll(t).forEach((e=>{r?.target!==e&&r?.currentTarget!==e||this.handleClick({preventDefault:r.preventDefault.bind(r),target:e})})):this.handleClick(r)}))}))}handleClick(e){let t=e?.target?.getAttribute("href");t||(t=e?.currentTarget?.getAttribute("href")),t&&0!==t.indexOf("http")&&(e.preventDefault(),r(this.basePath,(e=>{this.linkSource.give(e+t)})))}}class P{constructor(e,t){this.sources=e,this.selectorTemplate=t}element(r){const s=new t;this.sources.forEach((e=>{e.source.value(new n(r,s.guestKey(e.placeholder)))})),s.value(new n(r,(t=>{let s=this.selectorTemplate;Object.entries(t).map((e=>{s=s.replaceAll(e[0],e[1])}));const i=document.querySelector(s);i&&e(i,r)})))}}class E{constructor(e,t,r){this.activeClass=e,this.groupSelector=t,this.document=r}give(e){return r(this.document,new l((t=>{t.querySelectorAll(this.groupSelector).forEach((e=>{e.classList.remove(this.activeClass)})),e.classList.add(this.activeClass)}))),this}}class k{constructor(e,t,r){this.loaderSelector=e,this.navigationResultSelector=t,this.menuSelector=r}routes(r,l,v,w){l||(l=new m),l.value(new s(new u));const[f]=location.href.replace(location.origin,"").split("#");v||(v=new i(`${f}#`.replace("index.html","").replace("//","/")));const b=new i(!1);b.value(new s(new S(this.loaderSelector)));new h(l).watchPop();new p(b,v,l,new g(this.navigationResultSelector),new c(d)).routes(r);new y(l,v).watchClick(this.menuSelector);const k=new t;v.value(new s(k.guestKey("basePath"))),l.value(new s(k.guestKey("page")));const x=new o((t=>{k.value(new n(t,(({basePath:r,page:s})=>{e(s.replace(r,""),t)})))}));new P([{source:x,placeholder:"{url}"}],`${this.menuSelector} a[href="{url}"]`).element(new s(new E("active",`${this.menuSelector} a`,a(document)))),b.value(new s((e=>{if(e)return;w&&w();const t=document.querySelector(this.navigationResultSelector);t&&t.querySelectorAll("script").forEach((e=>{const r=document.createElement("script");r.setAttribute("type","module"),r.appendChild(document.createTextNode(e.innerText)),t.appendChild(r)}))})))}}class x{constructor(e){this.title=e}mounted(){document.title=this.title}}class A{constructor(e,t){this.title=e,this.entryPointUrl=t}mounted(){document.title=this.title,import(this.entryPointUrl).then((e=>{e.main&&e.main()}))}}var K=Object.defineProperty,O=(e,t,r)=>((e,t,r)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);class q{constructor(e,n=[],c=[],o=!1){this.alwaysKeep=n,this.excludeKeys=c,O(this,"comparingSource",new i),O(this,"all",new t),this.comparingSource.value(new s(this.all.guestKey("comparing"))),r(e,new s(this.all.guestKey("base"))),o&&r(e,new l(this))}give(t){return e(JSON.parse(JSON.stringify(t)),this.comparingSource),this}value(t){return this.all.value(new n(t,(({comparing:r,base:s})=>{r&&e(Object.fromEntries(Object.entries(r).filter((([e,t])=>!!this.alwaysKeep.includes(e)||!this.excludeKeys.includes(e)&&t!==s[e]))),t)}))),this}}var C=Object.defineProperty,T=(e,t,r)=>((e,t,r)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class j{constructor(e,t){this.loadingStartSource=e,this.loadingFinishSource=t,T(this,"loadingSource",new i)}value(e){return r(this.loadingStartSource,new n(e,(()=>{this.loadingSource.give(!0)}))),r(this.loadingFinishSource,new n(e,(()=>{this.loadingSource.give(!1)}))),this.loadingSource.value(e),this}}class L{}var N=Object.defineProperty,$=(e,t,r)=>((e,t,r)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,t+"",r);class R{constructor(e){$(this,"source",new i({})),r(e,new s((([e,t])=>{this.source.value((r=>{r[e]=t}))})))}value(e){return r(this.source,e),this}}export{P as ComputedElement,m as CurrentPage,q as Dirty,A as EntryPointPage,E as GroupActiveClass,R as HashTable,f as Input,y as Link,j as Loading,p as Navigation,x as Page,d as PageFetchTransport,g as RouteDisplay,k as Router,b as Text,L as Touched,S as Visible};
//# sourceMappingURL=silentium-components.min.mjs.map
