import{give as e,SourceAll as t,value as s,Patron as r,SourceChangeable as i,GuestCast as n,PatronOnce as o,PrivateClass as c,Source as l,sourceOf as a,SourceFiltered as u}from"silentium";import{HistoryNewPage as h,HistoryPoppedPage as d}from"silentium-web-api";class p{constructor(e,t){this.basePath=e,this.template=t}content(t){fetch(this.basePath+"/"+this.template).then((e=>e.text())).then((s=>{e(s,t)}))}}class g{constructor(e,t,s,r,i){this.loading=e,this.basePath=t,this.currentPage=s,this.display=r,this.pageTransport=i}routes(i){const n=i.find((e=>e.default)),o=new t;s(this.basePath,new r(o.guestKey("basePath"))),s(this.currentPage,new r(o.guestKey("currentPage"))),o.value(new r((({basePath:t,currentPage:s})=>{const r=s.replace(t,""),o=i.find((e=>e.aliases&&(e.aliases.includes(s)||e.aliases.includes(r))));if(o){const r=t+o.url;if(r!==s)return void e(r,this.currentPage)}let c=i.find((e=>{if(e.url.indexOf("*")>=0){return new RegExp(e.url.replaceAll("*",".*").replaceAll("/","/")).test(r)}return e.url.replaceAll("*","")===r}));if(!c&&n&&(c=n),!c)throw new Error("No matching route in Navigation");{const s=t.replace("/#","").replace("#","").replace(/[^/]+\.html$/,"");e(!0,this.loading),this.pageTransport.get(s,c.template).content((t=>{this.display.display(t),c.page.mounted(),e(!1,this.loading)}))}})))}}class v{constructor(e){this.selector=e}display(e){const t=document.querySelector(this.selector);t&&(t.innerHTML=e)}}var w=Object.defineProperty,m=(e,t,s)=>((e,t,s)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class y{constructor(){m(this,"source");const e=location.href.replace(location.origin,"");this.source=new i(e)}give(e){return this.source.give(e),this}value(e){return this.source.value(e),e}pool(){return this.source.pool()}}class S{constructor(e,t){this.source=e;const s=document.querySelector(t);this.source.value(new r((e=>{s.value=String(e)}))),s.addEventListener("keyup",(()=>{this.give(s.value)})),s.addEventListener("change",(()=>{this.give(s.value)}))}value(e){return this.source.value(e),this}give(e){return this.source.give(e),this}pool(){return this.source.pool()}}class b{constructor(e){this.selector=e}give(e){const t=document.querySelector(this.selector);return t&&(t.style.display=e?"block":"none"),this}}class f{constructor(e){this.selector=e}give(e){const t=document.querySelector(this.selector);return t&&(t.innerText=String(e)),this}}class P{constructor(e,t){this.linkSource=e,this.basePath=t}watchClick(e,t){const s=document.querySelectorAll(e);if(!s.length)throw new Error(`Link wrapper not found for selector ${e}`);s.forEach((e=>{e.addEventListener("click",(s=>{t?e.querySelectorAll(t).forEach((e=>{s?.target!==e&&s?.currentTarget!==e||this.handleClick({preventDefault:s.preventDefault.bind(s),target:e})})):this.handleClick(s)}))}))}handleClick(e){let t=e?.target?.getAttribute("href");t||(t=e?.currentTarget?.getAttribute("href")),t&&0!==t.indexOf("http")&&(e.preventDefault(),s(this.basePath,(e=>{this.linkSource.give(e+t)})))}}class k{constructor(e,t){this.sources=e,this.selectorTemplate=t}element(s){const r=new t;this.sources.forEach((e=>{e.source.value(new n(s,r.guestKey(e.placeholder)))})),r.value(new n(s,(t=>{let r=this.selectorTemplate;Object.entries(t).map((e=>{r=r.replaceAll(e[0],e[1])}));const i=document.querySelector(r);i&&e(i,s)})))}}class E{constructor(e,t,s){this.activeClass=e,this.groupSelector=t,this.document=s}give(e){return s(this.document,new o((t=>{t.querySelectorAll(this.groupSelector).forEach((e=>{e.classList.remove(this.activeClass)})),e.classList.add(this.activeClass)}))),this}}class T{constructor(e,t,s){this.loaderSelector=e,this.navigationResultSelector=t,this.menuSelector=s}routes(s,o,u,w){o||(o=new y),o.value(new r(new h));const[m]=location.href.replace(location.origin,"").split("#");u||(u=new i(`${m}#`.replace("index.html","").replace("//","/")));const S=new i(!1);S.value(new r(new b(this.loaderSelector)));new d(o).watchPop();new g(S,u,o,new v(this.navigationResultSelector),new c(p)).routes(s);new P(o,u).watchClick(this.menuSelector);const f=new t;u.value(new r(f.guestKey("basePath"))),o.value(new r(f.guestKey("page")));const T=new l((t=>{f.value(new n(t,(({basePath:s,page:r})=>{e(r.replace(s,""),t)})))}));new k([{source:T,placeholder:"{url}"}],`${this.menuSelector} a[href="{url}"]`).element(new r(new E("active",`${this.menuSelector} a`,a(document)))),S.value(new r((e=>{if(e)return;w&&w();const t=document.querySelector(this.navigationResultSelector);t&&t.querySelectorAll("script").forEach((e=>{const s=document.createElement("script");s.setAttribute("type","module"),s.appendChild(document.createTextNode(e.innerText)),t.appendChild(s)}))})))}}class K{constructor(e){this.title=e}mounted(){document.title=this.title}}class x{constructor(e,t){this.title=e,this.entryPointUrl=t}mounted(){document.title=this.title,import(this.entryPointUrl).then((e=>{e.main&&e.main()}))}}var A=Object.defineProperty,O=(e,t,s)=>((e,t,s)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class q{constructor(e,n=[],c=[],l=!1){this.alwaysKeep=n,this.excludeKeys=c,O(this,"comparingSource",new i),O(this,"all",new t),this.comparingSource.value(new r(this.all.guestKey("comparing"))),s(e,new r(this.all.guestKey("base"))),l&&s(e,new o(this))}give(t){return e(JSON.parse(JSON.stringify(t)),this.comparingSource),this}value(t){return this.all.value(new n(t,(({comparing:s,base:r})=>{s&&e(Object.fromEntries(Object.entries(s).filter((([e,t])=>!!this.alwaysKeep.includes(e)||!this.excludeKeys.includes(e)&&t!==r[e]))),t)}))),this}}var C=Object.defineProperty,j=(e,t,s)=>((e,t,s)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class L{constructor(e,t){this.loadingStartSource=e,this.loadingFinishSource=t,j(this,"loadingSource",new i)}value(e){return s(this.loadingStartSource,new n(e,(()=>{this.loadingSource.give(!0)}))),s(this.loadingFinishSource,new n(e,(()=>{this.loadingSource.give(!1)}))),this.loadingSource.value(e),this}}class N{}class ${constructor(e,t){this.baseSource=e,this.keyType=t}value(r){const i=new t(["base","key"]);return s(this.baseSource,new n(r,i.guestKey("base"))),s(this.keyType,new n(r,i.guestKey("key"))),i.value(new n(r,(({base:t,key:s})=>{const i=s.split(".");let n=t;i.forEach((e=>{n=n[e]})),void 0!==n&&n!==t&&e(n,r)}))),this}}class D{constructor(e,t,s){this.baseSource=e,this.errorSource=t,this.timeout=s}value(t){return s(this.timeout,new n(t,(r=>{let i=!1;setTimeout((()=>{i||(i=!0,e(new Error("Timeout reached in Deadline class"),this.errorSource))}),r),new u(this.baseSource,(()=>!i)).value(t),s(this.baseSource,new o((()=>{i=!0})))}))),this}}var R=Object.defineProperty,F=(e,t,s)=>((e,t,s)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class J{constructor(e){F(this,"source",new i({})),s(e,new r((([e,t])=>{this.source.value((s=>{s[e]=t}))})))}value(e){return s(this.source,e),this}}export{k as ComputedElement,y as CurrentPage,D as Deadline,q as Dirty,x as EntryPointPage,E as GroupActiveClass,J as HashTable,S as Input,P as Link,L as Loading,g as Navigation,K as Page,p as PageFetchTransport,$ as Path,v as RouteDisplay,T as Router,f as Text,N as Touched,b as Visible};
//# sourceMappingURL=silentium-components.min.mjs.map
