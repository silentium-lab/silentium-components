import{give as e,SourceAll as t,value as s,Patron as r,SourceChangeable as i,GuestCast as n,PatronOnce as l,PrivateClass as c,Source as o,sourceOf as a}from"silentium";import{HistoryNewPage as u,HistoryPoppedPage as h}from"silentium-web-api";class p{constructor(e,t){this.basePath=e,this.template=t}content(t){fetch(this.basePath+"/"+this.template).then((e=>e.text())).then((s=>{e(s,t)}))}}class d{constructor(e,t,s,r,i){this.loading=e,this.basePath=t,this.currentPage=s,this.display=r,this.pageTransport=i}routes(i){const n=i.find((e=>e.default)),l=new t;s(this.basePath,new r(l.guestKey("basePath"))),s(this.currentPage,new r(l.guestKey("currentPage"))),l.value(new r((({basePath:t,currentPage:s})=>{const r=s.replace(t,""),l=i.find((e=>e.aliases&&(e.aliases.includes(s)||e.aliases.includes(r))));if(l){const r=t+l.url;if(r!==s)return void e(r,this.currentPage)}let c=i.find((e=>{if(e.url.indexOf("*")>=0){return new RegExp(e.url.replaceAll("*",".*").replaceAll("/","/")).test(r)}return e.url.replaceAll("*","")===r}));if(!c&&n&&(c=n),!c)throw new Error("No matching route in Navigation");{const s=t.replace("/#","").replace("#","").replace(/[^/]+\.html$/,"");e(!0,this.loading),this.pageTransport.get(s,c.template).content((t=>{this.display.display(t),c.page.mounted(),e(!1,this.loading)}))}})))}}class g{constructor(e){this.selector=e}display(e){const t=document.querySelector(this.selector);t&&(t.innerHTML=e)}}var v=Object.defineProperty,w=(e,t,s)=>((e,t,s)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class m{constructor(){w(this,"source");const e=location.href.replace(location.origin,"");this.source=new i(e)}give(e){return this.source.give(e),this}value(e){return this.source.value(e),e}pool(){return this.source.pool()}}class y{constructor(e,t){this.source=e;const s=document.querySelector(t);this.source.value(new r((e=>{s.value=String(e)}))),s.addEventListener("keyup",(()=>{this.give(s.value)})),s.addEventListener("change",(()=>{this.give(s.value)}))}value(e){return this.source.value(e),this}give(e){return this.source.give(e),this}pool(){return this.source.pool()}}class b{constructor(e){this.selector=e}give(e){const t=document.querySelector(this.selector);return t&&(t.style.display=e?"block":"none"),this}}class f{constructor(e){this.selector=e}give(e){const t=document.querySelector(this.selector);return t&&(t.innerText=String(e)),this}}class S{constructor(e,t){this.linkSource=e,this.basePath=t}watchClick(e,t){const s=document.querySelectorAll(e);if(!s.length)throw new Error(`Link wrapper not found for selector ${e}`);s.forEach((e=>{e.addEventListener("click",(s=>{t?e.querySelectorAll(t).forEach((e=>{s?.target!==e&&s?.currentTarget!==e||this.handleClick({preventDefault:s.preventDefault.bind(s),target:e})})):this.handleClick(s)}))}))}handleClick(e){let t=e?.target?.getAttribute("href");t||(t=e?.currentTarget?.getAttribute("href")),t&&0!==t.indexOf("http")&&(e.preventDefault(),s(this.basePath,(e=>{this.linkSource.give(e+t)})))}}class P{constructor(e,t){this.sources=e,this.selectorTemplate=t}element(s){const r=new t;this.sources.forEach((e=>{e.source.value(new n(s,r.guestKey(e.placeholder)))})),r.value(new n(s,(t=>{let r=this.selectorTemplate;Object.entries(t).map((e=>{r=r.replaceAll(e[0],e[1])}));const i=document.querySelector(r);i&&e(i,s)})))}}class k{constructor(e,t,s){this.activeClass=e,this.groupSelector=t,this.document=s}give(e){return s(this.document,new l((t=>{t.querySelectorAll(this.groupSelector).forEach((e=>{e.classList.remove(this.activeClass)})),e.classList.add(this.activeClass)}))),this}}class E{constructor(e,t,s){this.loaderSelector=e,this.navigationResultSelector=t,this.menuSelector=s}routes(s,l,v,w){l||(l=new m),l.value(new r(new u));const[y]=location.href.replace(location.origin,"").split("#");v||(v=new i(`${y}#`.replace("index.html","").replace("//","/")));const f=new i(!1);f.value(new r(new b(this.loaderSelector)));new h(l).watchPop();new d(f,v,l,new g(this.navigationResultSelector),new c(p)).routes(s);new S(l,v).watchClick(this.menuSelector);const E=new t;v.value(new r(E.guestKey("basePath"))),l.value(new r(E.guestKey("page")));const K=new o((t=>{E.value(new n(t,(({basePath:s,page:r})=>{e(r.replace(s,""),t)})))}));new P([{source:K,placeholder:"{url}"}],`${this.menuSelector} a[href="{url}"]`).element(new r(new k("active",`${this.menuSelector} a`,a(document)))),f.value(new r((e=>{if(e)return;w&&w();const t=document.querySelector(this.navigationResultSelector);t&&t.querySelectorAll("script").forEach((e=>{const s=document.createElement("script");s.setAttribute("type","module"),s.appendChild(document.createTextNode(e.innerText)),t.appendChild(s)}))})))}}class K{constructor(e){this.title=e}mounted(){document.title=this.title}}class T{constructor(e,t){this.title=e,this.entryPointUrl=t}mounted(){document.title=this.title,import(this.entryPointUrl).then((e=>{e.main&&e.main()}))}}var x=Object.defineProperty,A=(e,t,s)=>((e,t,s)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);class O{constructor(e,n=[],c=[],o=!1){this.alwaysKeep=n,this.excludeKeys=c,A(this,"comparingSource",new i),A(this,"all",new t),this.comparingSource.value(new r(this.all.guestKey("comparing"))),s(e,new r(this.all.guestKey("base"))),o&&s(e,new l(this))}give(t){return e(JSON.parse(JSON.stringify(t)),this.comparingSource),this}value(t){return this.all.value(new n(t,(({comparing:s,base:r})=>{s&&e(Object.fromEntries(Object.entries(s).filter((([e,t])=>!!this.alwaysKeep.includes(e)||!this.excludeKeys.includes(e)&&t!==r[e]))),t)}))),this}}var q=Object.defineProperty,C=(e,t,s)=>((e,t,s)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class j{constructor(e,t){this.loadingStartSource=e,this.loadingFinishSource=t,C(this,"loadingSource",new i)}value(e){return s(this.loadingStartSource,new n(e,(()=>{this.loadingSource.give(!0)}))),s(this.loadingFinishSource,new n(e,(()=>{this.loadingSource.give(!1)}))),this.loadingSource.value(e),this}}class L{}class N{constructor(e,t){this.baseSource=e,this.keyType=t}value(r){const i=new t(["base","key"]);return s(this.baseSource,new n(r,i.guestKey("base"))),s(this.keyType,new n(r,i.guestKey("key"))),i.value(new n(r,(({base:t,key:s})=>{const i=s.split(".");let n=t;i.forEach((e=>{n=n[e]})),void 0!==n&&n!==t&&e(n,r)}))),this}}var $=Object.defineProperty,R=(e,t,s)=>((e,t,s)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,t+"",s);class D{constructor(e){R(this,"source",new i({})),s(e,new r((([e,t])=>{this.source.value((s=>{s[e]=t}))})))}value(e){return s(this.source,e),this}}export{P as ComputedElement,m as CurrentPage,O as Dirty,T as EntryPointPage,k as GroupActiveClass,D as HashTable,y as Input,S as Link,j as Loading,d as Navigation,K as Page,p as PageFetchTransport,N as Path,g as RouteDisplay,E as Router,f as Text,L as Touched,b as Visible};
//# sourceMappingURL=silentium-components.min.mjs.map
