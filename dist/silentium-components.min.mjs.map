{"version":3,"file":"silentium-components.min.mjs","sources":["../src/behaviors/Branch.ts","../src/behaviors/BranchLazy.ts","../src/behaviors/Const.ts","../src/behaviors/Deadline.ts","../src/behaviors/Deferred.ts","../src/behaviors/Detached.ts","../src/behaviors/Dirty.ts","../src/behaviors/Loading.ts","../src/behaviors/Lock.ts","../src/behaviors/Memo.ts","../src/behaviors/OnlyChanged.ts","../src/behaviors/Part.ts","../src/behaviors/Path.ts","../src/behaviors/Polling.ts","../src/behaviors/Shot.ts","../src/behaviors/Task.ts","../src/behaviors/Tick.ts","../src/boolean/And.ts","../src/boolean/Bool.ts","../src/boolean/Not.ts","../src/boolean/Or.ts","../src/formats/FromJson.ts","../src/formats/ToJson.ts","../src/lists/First.ts","../src/system/RegexpMatch.ts","../src/system/RegexpMatched.ts","../src/system/RegexpReplaced.ts","../src/system/Set.ts","../src/navigation/Router.ts","../src/strings/Concatenated.ts","../src/structures/HashTable.ts","../src/structures/Record.ts","../src/strings/Template.ts"],"sourcesContent":["import { ActualMessage, MaybeMessage, Message, Primitive } from \"silentium\";\n\n/**\n * Allows switching between left and right messages depending on condition\n * https://silentium-lab.github.io/silentium-components/#/behaviors/branch\n */\nexport function Branch<Then, Else>(\n  _condition: MaybeMessage<boolean>,\n  _left: MaybeMessage<Then>,\n  _right?: MaybeMessage<Else>,\n) {\n  const $condition = ActualMessage(_condition);\n  const $left = ActualMessage(_left);\n  const $right = _right && ActualMessage(_right);\n  return Message<Then | Else>(function BranchImpl(r) {\n    const left = Primitive($left);\n    let right: ReturnType<typeof Primitive<Else>>;\n    if ($right !== undefined) {\n      right = Primitive($right);\n    }\n    $condition.then((v) => {\n      let result: Then | Else | null = null;\n      if (v) {\n        result = left.primitive();\n      } else if (right) {\n        result = right.primitive();\n      }\n      if (result !== null) {\n        r(result);\n      }\n    });\n  });\n}\n","import {\n  ConstructorType,\n  DestroyableType,\n  DestroyContainer,\n  Message,\n  MessageType,\n} from \"silentium\";\n\n/**\n * Depending on the $condition message,\n * creates a new left or right message.\n * When condition changes, old messages are destroyed\n * and new ones are created.\n */\nexport function BranchLazy<Then, Else>(\n  $condition: MessageType<boolean>,\n  $left: ConstructorType<[], MessageType<Then>>,\n  $right?: ConstructorType<[], MessageType<Else>>,\n): MessageType<Then | Else> & DestroyableType {\n  return Message(function BranchLazyImpl(r) {\n    const dc = DestroyContainer();\n    const destructor = () => {\n      dc.destroy();\n    };\n    $condition.then((v) => {\n      destructor();\n      let instance: MessageType<Then | Else> | undefined;\n      if (v) {\n        instance = $left();\n      } else if ($right) {\n        instance = $right();\n      }\n      if (instance !== undefined) {\n        instance.then(r);\n        dc.add(instance);\n      }\n    });\n    return destructor;\n  });\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * Constant value that will be\n * returned on each value from\n * the $trigger message\n */\nexport function Constant<T>(\n  permanent: T,\n  $trigger: MessageType,\n): MessageType<T> {\n  return Message(function ConstantImpl(r) {\n    $trigger.then(() => {\n      r(permanent);\n    });\n  });\n}\n","import {\n  ActualMessage,\n  Filtered,\n  MaybeMessage,\n  Message,\n  MessageType,\n  Shared,\n} from \"silentium\";\n\n/**\n * Will return an error via error transport if\n * time runs out from $timeout; if $base manages to\n * respond before $timeout then the value from base will be returned\n */\nexport function Deadline<T>(\n  $base: MessageType<T>,\n  _timeout: MaybeMessage<number>,\n) {\n  const $timeout = ActualMessage(_timeout);\n  return Message<T>(function DeadlineImpl(resolve, reject) {\n    let timer: ReturnType<typeof setTimeout> | number = 0;\n    const base = Shared($base);\n    $timeout.then((timeout) => {\n      if (timer) {\n        clearTimeout(timer);\n      }\n      let timeoutReached = false;\n\n      timer = setTimeout(() => {\n        if (timeoutReached) {\n          return;\n        }\n        timeoutReached = true;\n        reject(new Error(\"Timeout reached in Deadline\"));\n      }, timeout);\n\n      const f = Filtered(base, () => !timeoutReached);\n      f.then(resolve);\n\n      base.then(() => {\n        timeoutReached = true;\n      });\n    });\n  });\n}\n","import { isFilled, Message, MessageType, Primitive } from \"silentium\";\n\n/**\n * Defer one source after another, gives values Of baseSrc only when triggerSrc responds\n * https://silentium-lab.github.io/silentium-components/#/behaviors/deferred\n */\nexport function Deferred<T>(\n  $base: MessageType<T>,\n  $trigger: MessageType<unknown>,\n) {\n  return Message(function DeferredImpl(r) {\n    const base = Primitive($base);\n    $trigger.then(() => {\n      const value = base.primitive();\n      if (isFilled(value)) {\n        r(value);\n      }\n    });\n  });\n}\n","import { isFilled, Message, MessageType, Primitive } from \"silentium\";\n\n/**\n * Message separate from the base\n * allows to take one value from the base\n * but not react to new values of the base message\n */\nexport function Detached<T>($base: MessageType<T>): MessageType<T> {\n  return Message(function DetachedImpl(r) {\n    const v = Primitive($base).primitive();\n    if (isFilled(v)) {\n      r(v);\n    }\n  });\n}\n","import { All, Applied, Late, MessageSource, MessageType } from \"silentium\";\n\n/**\n * Takes source and remember it first value\n * returns new record, what will contain only fields what was changed\n * https://silentium-lab.github.io/silentium-components/#/behaviors/dirty\n */\nexport function Dirty<T>(\n  $base: MessageType<T>,\n  keep: string[] = [],\n  exclude: string[] = [],\n  cloner?: (v: T) => T,\n) {\n  const $comparing = Late<T>();\n  if (cloner === undefined) {\n    cloner = (value) => JSON.parse(JSON.stringify(value));\n  }\n  return MessageSource<T>(\n    function DirtyImpl(r) {\n      const $comparingClone = Applied($comparing, cloner);\n      All($comparingClone, $base).then(([comparing, base]) => {\n        if (!comparing) {\n          return;\n        }\n        r(\n          Object.fromEntries(\n            Object.entries(comparing).filter(([key, value]) => {\n              if (keep.includes(key)) {\n                return true;\n              }\n              if (exclude.includes(key)) {\n                return false;\n              }\n              return value !== (base as Record<string, unknown>)[key];\n            }),\n          ) as T,\n        );\n      });\n    },\n    (v) => {\n      $comparing.use(v);\n    },\n  );\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * Representation Of loading process\n * first message begins loading\n * second message stops loading\n * https://silentium-lab.github.io/silentium-components/#/behaviors/loading\n */\nexport function Loading(\n  $start: MessageType<unknown>,\n  $finish: MessageType<unknown>,\n) {\n  return Message<boolean>(function LoadingImpl(r) {\n    $start.then(() => r(true));\n    $finish.then(() => r(false));\n  });\n}\n","import { Filtered, Message, MessageType } from \"silentium\";\n\n/**\n * Allows locking messages\n * if a $lock message arrives\n * https://silentium-lab.github.io/silentium-components/#/behaviors/lock\n */\nexport function Lock<T>($base: MessageType<T>, $lock: MessageType<boolean>) {\n  return Message<T>(function LockImpl(r) {\n    let locked = false;\n    $lock.then((newLock) => {\n      locked = newLock;\n    });\n    const i = Filtered($base, () => !locked);\n    i.then(r);\n  });\n}\n","import { isFilled, Message, MessageType } from \"silentium\";\n\n/**\n * Didn't respond if new value Of baseSrc equals to old value\n * https://silentium-lab.github.io/silentium-components/#/behaviors/memo\n */\nexport function Memo<T>($base: MessageType<T>) {\n  return Message<T>(function MemoImpl(r) {\n    let last: T | null = null;\n    $base.then((v) => {\n      if (v !== last && isFilled(v)) {\n        r(v);\n        last = v;\n      }\n    });\n  });\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * Represents source what was changed at least once\n * https://silentium-lab.github.io/silentium-components/#/behaviors/only-changed\n */\nexport function OnlyChanged<T>($base: MessageType<T>) {\n  return Message<T>(function OnlyChangedImpl(r) {\n    let first = false;\n    $base.then((v) => {\n      if (first === false) {\n        first = true;\n      } else {\n        r(v);\n      }\n    });\n  });\n}\n","import {\n  ActualMessage,\n  All,\n  isFilled,\n  MaybeMessage,\n  MessageSource,\n  MessageSourceType,\n  Primitive,\n  Shared,\n  SourceType,\n} from \"silentium\";\n\n/**\n * Return source Of record path\n * https://silentium-lab.github.io/silentium-components/#/behaviors/path\n */\nexport function Part<\n  R,\n  T extends object | Array<any> = any,\n  K extends string = any,\n>($base: MessageSourceType<T>, key: MaybeMessage<K>): SourceType<R> {\n  const $baseShared = Shared($base);\n  const $keyedShared = Shared(ActualMessage(key));\n  return MessageSource(\n    function PartImpl(r) {\n      All($baseShared, $keyedShared).then(([base, keyed]) => {\n        const keys = keyed.split(\".\");\n        let value: unknown = base;\n        keys.forEach((key: string) => {\n          value = (value as Record<string, unknown>)[key];\n        });\n        if (value !== undefined && value !== base) {\n          r(value as R);\n        }\n      });\n    },\n    (value) => {\n      const key = Primitive($keyedShared);\n      if (isFilled(key)) {\n        const base = Primitive($base);\n        $base.use({\n          ...base.primitiveWithException(),\n          [key.primitiveWithException()]: value,\n        } as T);\n      }\n    },\n  );\n}\n","import {\n  ActualMessage,\n  All,\n  MaybeMessage,\n  Message,\n  MessageType,\n} from \"silentium\";\n\n/**\n * Return source Of record path\n * https://silentium-lab.github.io/silentium-components/#/behaviors/path\n */\nexport function Path<\n  R,\n  T extends object | Array<any> = any,\n  K extends string = any,\n>($base: MessageType<T>, _keyed: MaybeMessage<K>) {\n  const $keyed = ActualMessage(_keyed);\n  return Message<R>(function PathImpl(r) {\n    All($base, $keyed).then(([base, keyed]) => {\n      const keys = keyed.split(\".\");\n      let value: unknown = base;\n      keys.forEach((key) => {\n        value = (value as Record<string, unknown>)[key];\n      });\n      if (value !== undefined && value !== base) {\n        r(value as R);\n      }\n    });\n  });\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * Active polling of $base message\n * synchronized with $trigger message\n */\nexport function Polling<T>($base: MessageType<T>, $trigger: MessageType<T>) {\n  return Message<T>(function PollingImpl(r) {\n    $trigger.then(() => {\n      $base.then(r);\n    });\n  });\n}\n","import { isFilled, Message, MessageType, Primitive } from \"silentium\";\n\n/**\n * Helps to represent only last fresh value Of some source, refreshing controls by shotSrc\n * https://silentium-lab.github.io/silentium-components/#/behaviors/shot\n */\nexport function Shot<T>($target: MessageType<T>, $trigger: MessageType) {\n  return Message<T>(function ShotImpl(r) {\n    const targetSync = Primitive($target);\n    targetSync.primitive();\n    $trigger.then(() => {\n      const value = targetSync.primitive();\n      if (isFilled(value)) {\n        r(value);\n      }\n    });\n  });\n}\n","import {\n  ActualMessage,\n  ExecutorApplied,\n  MaybeMessage,\n  Message,\n} from \"silentium\";\n\n/**\n * Defer a message to the event loop\n * so that it executes once within\n * a certain timer firing interval\n */\nexport function Task<T>(baseSrc: MaybeMessage<T>, delay: number = 0) {\n  const $base = ActualMessage(baseSrc);\n  return Message<T>(function TaskImpl(r) {\n    let prevTimer: unknown | null = null;\n    ExecutorApplied($base, (fn) => {\n      return (v) => {\n        if (prevTimer) {\n          clearTimeout(prevTimer as number);\n        }\n        prevTimer = setTimeout(() => {\n          fn(v);\n        }, delay);\n      };\n    }).then(r);\n  });\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * Accumulates the last value Of the source and returns one result once per tick\n * https://silentium-lab.github.io/silentium-components/#/behaviors/tick\n */\nexport function Tick<T>($base: MessageType<T>) {\n  return Message(function TickImpl(r) {\n    let microtaskScheduled = false;\n    let lastValue: T | null = null;\n\n    const scheduleMicrotask = () => {\n      microtaskScheduled = true;\n      queueMicrotask(() => {\n        microtaskScheduled = false;\n        if (lastValue !== null) {\n          r(lastValue);\n          lastValue = null;\n        }\n      });\n    };\n\n    $base.then((v) => {\n      lastValue = v;\n      if (!microtaskScheduled) {\n        scheduleMicrotask();\n      }\n    });\n  });\n}\n","import { All, Message, MessageType } from \"silentium\";\n\n/**\n * Logical AND over two messages\n * https://silentium-lab.github.io/silentium-components/#/boolean/and\n */\nexport function And($one: MessageType<boolean>, $two: MessageType<boolean>) {\n  return Message<boolean>(function AndImpl(r) {\n    All($one, $two).then(([one, two]) => {\n      r(!!(one && two));\n    });\n  });\n}\n","import { Applied, Message, MessageType } from \"silentium\";\n\n/**\n * Convert Any source to boolean source\n * https://silentium-lab.github.io/silentium-components/#/boolean/bool\n */\nexport function Bool($base: MessageType) {\n  return Message<boolean>(function BoolImpl(r) {\n    Applied($base, Boolean).then(r);\n  });\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * Logical negation of message\n * https://silentium-lab.github.io/silentium-components/#/boolean/not\n */\nexport function Not($base: MessageType<boolean>) {\n  return Message<boolean>(function NotImpl(r) {\n    $base.then((v) => {\n      r(!v);\n    });\n  });\n}\n","import { All, Message, MessageType } from \"silentium\";\n\n/**\n * Logical OR over two messages\n * https://silentium-lab.github.io/silentium-components/#/boolean/or\n */\nexport function Or($one: MessageType<boolean>, $two: MessageType<boolean>) {\n  return Message<boolean>(function OrImpl(r) {\n    All($one, $two).then(([one, two]) => {\n      r(!!(one || two));\n    });\n  });\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * Represents object from json\n */\nexport function FromJson<T = Record<string, unknown>>(\n  $json: MessageType<string>,\n) {\n  return Message<T>(function FromJsonImpl(resolve, reject) {\n    $json.then((json) => {\n      try {\n        resolve(JSON.parse(json));\n      } catch (e) {\n        reject(new Error(`Failed to parse JSON: ${e}`));\n      }\n    });\n  });\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * Represents json from object\n */\nexport function ToJson($data: MessageType) {\n  return Message<string>(function ToJsonImpl(resolve, reject) {\n    $data.then((data: unknown) => {\n      try {\n        resolve(JSON.stringify(data));\n      } catch {\n        reject(new Error(\"Failed to convert to JSON\"));\n      }\n    });\n  });\n}\n","import { Applied, Message, MessageType } from \"silentium\";\n\n/**\n * Represents the first element Of an array.\n */\nexport function First<T extends Array<unknown>>($base: MessageType<T>) {\n  return Message<T[0]>(function FirstImpl(r) {\n    Applied($base, (a) => a[0]).then(r);\n  });\n}\n","import { ActualMessage, All, MaybeMessage, Message, Of } from \"silentium\";\n\n/**\n * First match Of regexp\n * https://silentium-lab.github.io/silentium-components/#/system/regexp-matched\n */\nexport function RegexpMatch(\n  patternSrc: MaybeMessage<string>,\n  valueSrc: MaybeMessage<string>,\n  flagsSrc: MaybeMessage<string> = Of(\"\"),\n) {\n  const $pattern = ActualMessage(patternSrc);\n  const $value = ActualMessage(valueSrc);\n  const $flags = ActualMessage(flagsSrc);\n  return Message<string[]>(function RegexpMatchImpl(r) {\n    All($pattern, $value, $flags).then(([pattern, value, flags]) => {\n      const result = new RegExp(pattern, flags).exec(value);\n      r(result ?? []);\n    });\n  });\n}\n","import { ActualMessage, All, MaybeMessage, Message, Of } from \"silentium\";\n\n/**\n * Boolean source what checks what string matches pattern\n * https://silentium-lab.github.io/silentium-components/#/system/regexp-matched\n */\nexport function RegexpMatched(\n  patternSrc: MaybeMessage<string>,\n  valueSrc: MaybeMessage<string>,\n  flagsSrc: MaybeMessage<string> = Of(\"\"),\n) {\n  const $pattern = ActualMessage(patternSrc);\n  const $value = ActualMessage(valueSrc);\n  const $flags = ActualMessage(flagsSrc);\n  return Message<boolean>(function RegexpMatchedImpl(r) {\n    All($pattern, $value, $flags).then(([pattern, value, flags]) => {\n      r(new RegExp(pattern, flags).test(value));\n    });\n  });\n}\n","import { All, Message, MessageType, Of } from \"silentium\";\n\n/**\n * Returns string replaced by regular expression pattern\n * https://silentium-lab.github.io/silentium-components/#/system/regexp-replaced\n */\nexport function RegexpReplaced(\n  valueSrc: MessageType<string>,\n  patternSrc: MessageType<string>,\n  replaceValueSrc: MessageType<string>,\n  flagsSrc: MessageType<string> = Of(\"\"),\n) {\n  return Message<string>(function RegexpReplacedImpl(r) {\n    All(patternSrc, valueSrc, replaceValueSrc, flagsSrc).then(\n      ([pattern, value, replaceValue, flags]) => {\n        r(String(value).replace(new RegExp(pattern, flags), replaceValue));\n      },\n    );\n  });\n}\n","import { ActualMessage, All, Message, MessageType } from \"silentium\";\n\n/**\n * Ability to mutate some object, helpful when integrate to procedure systems\n * https://silentium-lab.github.io/silentium-components/#/system/set\n */\nexport function Set<T extends Record<string, unknown>>(\n  baseSrc: MessageType<T>,\n  keySrc: MessageType<string>,\n  valueSrc: MessageType<unknown>,\n) {\n  const $base = ActualMessage(baseSrc);\n  const $key = ActualMessage(keySrc);\n  const $value = ActualMessage(valueSrc);\n  return Message<T>(function SetImpl(r) {\n    All($base, $key, $value).then(([base, key, value]) => {\n      (base as Record<string, unknown>)[key] = value;\n      r(base);\n    });\n  });\n}\n","import {\n  All,\n  ConstructorType,\n  DestroyableType,\n  DestroyContainer,\n  Message,\n  MessageType,\n  Of,\n} from \"silentium\";\n\nimport { RegexpMatched } from \"../system\";\n\nexport interface Route<T> {\n  pattern: string;\n  patternFlags?: string;\n  message: ConstructorType<[], MessageType<T>>;\n}\n\n/**\n * Router component what will return template if url matches pattern\n * https://silentium-lab.github.io/silentium-components/#/navigation/router\n */\nexport function Router<T = string>(\n  $url: MessageType<string>,\n  $routes: MessageType<Route<T>[]>,\n  $default: ConstructorType<[], MessageType<T>>,\n): MessageType<T> & DestroyableType {\n  return Message<T>(function RouterImpl(r) {\n    const dc = DestroyContainer();\n    const destructor = () => {\n      dc.destroy();\n    };\n    All($routes, $url).then(([routes, url]) => {\n      destructor();\n      const $matches = All(\n        ...routes.map((r) =>\n          RegexpMatched(\n            Of(r.pattern),\n            Of(url),\n            r.patternFlags ? Of(r.patternFlags) : undefined,\n          ),\n        ),\n      );\n      $matches.then((matches) => {\n        const index = matches.findIndex((v) => v === true);\n\n        if (index === -1) {\n          const instance = $default();\n          dc.add(instance);\n          instance.then(r);\n        }\n\n        if (index > -1) {\n          const instance = routes[index].message();\n          dc.add(instance);\n          instance.then(r);\n        }\n      });\n    });\n\n    return destructor;\n  });\n}\n","import { All, Message, MessageType, Of } from \"silentium\";\n\n/**\n * Join sources Of strings to one source\n * https://silentium-lab.github.io/silentium-components/#/string/concatenated\n */\nexport function Concatenated(\n  sources: MessageType<string>[],\n  joinPartSrc: MessageType<string> = Of(\"\"),\n) {\n  return Message<string>(function ConcatenatedImpl(r) {\n    All(joinPartSrc, ...sources).then(([joinPart, ...strings]) => {\n      r(strings.join(joinPart));\n    });\n  });\n}\n","import { Message, MessageType } from \"silentium\";\n\n/**\n * By receiving a message with a key and value, collects a table\n * of all previously received messages in the form of a structure\n * https://silentium-lab.github.io/silentium-components/#/structures/hash-table\n */\nexport function HashTable<T>($base: MessageType<[string, unknown]>) {\n  return Message<T>(function HashTableImpl(r) {\n    const record: Record<string, unknown> = {};\n\n    $base.then(([key, value]) => {\n      record[key] = value;\n      r(record as T);\n    });\n  });\n}\n","import { ActualMessage, All, Message, MessageType } from \"silentium\";\n\ntype UnWrap<T> = T extends MessageType<infer U> ? U : T;\n\n/**\n * Returns record Of data from record Of sources\n * https://silentium-lab.github.io/silentium-components/#/structures/record\n */\nexport function Record<T>(record: Record<string, T>) {\n  return Message<Record<string, UnWrap<T>>>(function RecordImpl(r) {\n    const keys = Object.keys(record);\n    keys.forEach((key) => {\n      record[key] = ActualMessage(record[key]) as any;\n    });\n    All(...(Object.values(record) as any)).then((entries) => {\n      const record: Record<string, any> = {};\n      entries.forEach((entry, index) => {\n        record[keys[index]] = entry;\n      });\n      r(record);\n    });\n  });\n}\n","import {\n  All,\n  Applied,\n  ConstructorType,\n  DestroyableType,\n  DestroyContainer,\n  isDestroyable,\n  MessageType,\n  Of,\n  Rejections,\n} from \"silentium\";\n\nimport { Record } from \"../structures\";\n\n/**\n * Allows creating a string template with\n * variables inserted into it; when variables change,\n * the template value will change\n */\nexport function Template(\n  $src: MessageType<string> = Of(\"\"),\n  $places: MessageType<Record<string, unknown>> = Of({}),\n) {\n  return new TemplateImpl($src, $places);\n}\n\nclass TemplateImpl implements MessageType<string>, DestroyableType {\n  private dc = DestroyContainer();\n  private rejections = new Rejections();\n  private vars: Record<string, MessageType> = {\n    $TPL: Of(\"$TPL\"),\n  };\n\n  public constructor(\n    private $src: MessageType<string> = Of(\"\"),\n    private $places: MessageType<Record<string, unknown>> = Of({}),\n  ) {}\n\n  public then(transport: ConstructorType<[string]>): this {\n    const $vars = Record(this.vars);\n    Applied(All(this.$src, this.$places, $vars), ([base, rules, vars]) => {\n      try {\n        Object.entries(rules).forEach(([ph, val]) => {\n          base = base.replaceAll(ph, String(val));\n        });\n        Object.entries(vars).forEach(([ph, val]) => {\n          base = base.replaceAll(ph, String(val));\n        });\n      } catch (e) {\n        this.rejections.reject(e);\n      }\n\n      return base;\n    }).then(transport);\n    return this;\n  }\n\n  public template(value: string) {\n    this.$src = Of(value);\n  }\n\n  /**\n   * Ability to register variable\n   * in concrete place Of template\n   */\n  public var(src: MessageType<string>) {\n    const places = Object.keys(this.vars).length;\n    const varName = `$var${places}`;\n    if (isDestroyable(src)) {\n      this.dc.add(src);\n    }\n    this.vars[varName] = src;\n    return varName;\n  }\n\n  public catch(rejected: ConstructorType<[unknown]>): this {\n    this.rejections.catch(rejected);\n    return this;\n  }\n\n  public destroy(): this {\n    this.dc.destroy();\n    return this;\n  }\n}\n"],"names":["Branch","_condition","_left","_right","$condition","ActualMessage","$left","$right","Message","r","left","Primitive","right","then","v","result","primitive","BranchLazy","dc","DestroyContainer","destructor","destroy","instance","add","Constant","permanent","$trigger","Deadline","$base","_timeout","$timeout","resolve","reject","timer","base","Shared","timeout","clearTimeout","timeoutReached","setTimeout","Error","Filtered","Deferred","value","isFilled","Detached","Dirty","keep","exclude","cloner","$comparing","Late","JSON","parse","stringify","MessageSource","$comparingClone","Applied","All","comparing","Object","fromEntries","entries","filter","key","includes","use","Loading","$start","$finish","Lock","$lock","locked","newLock","Memo","last","OnlyChanged","first","Part","$baseShared","$keyedShared","keyed","keys","split","forEach","primitiveWithException","Path","_keyed","$keyed","Polling","Shot","$target","targetSync","Task","baseSrc","delay","prevTimer","ExecutorApplied","fn","Tick","microtaskScheduled","lastValue","queueMicrotask","And","$one","$two","one","two","Bool","Boolean","Not","Or","FromJson","$json","json","e","ToJson","$data","data","First","a","RegexpMatch","patternSrc","valueSrc","flagsSrc","Of","$pattern","$value","$flags","pattern","flags","RegExp","exec","RegexpMatched","test","RegexpReplaced","replaceValueSrc","replaceValue","String","replace","Set","keySrc","$key","Router","$url","$routes","$default","routes","url","map","patternFlags","matches","index","findIndex","message","Concatenated","sources","joinPartSrc","joinPart","strings","join","HashTable","record","Record","values","entry","Template","$src","$places","TemplateImpl","constructor","this","__publicField","Rejections","$TPL","transport","$vars","vars","rules","ph","val","replaceAll","rejections","template","src","varName","length","isDestroyable","rejected","catch"],"mappings":"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"}