!function(e,t){"use strict";function n(e,n,r){return t.Event((s=>{let i;const o=()=>{void 0!==i&&(i.destroy(),i=void 0)};return e.event(t.Transport((e=>{let u;o(),e?u=n.use():r&&(u=r.use()),void 0!==u&&(u.event(s),t.isDestroyable(u)&&(i=u))}))),o}))}function r(e){return t.Event((n=>{const r=t.Primitive(e).primitive();t.isFilled(r)&&n.use(r)}))}var s=Object.defineProperty,i=(e,t,n)=>((e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class o{constructor(e,n=[],r=[],s){this.$base=e,this.keep=n,this.exclude=r,i(this,"$comparing",t.Late()),i(this,"cloner"),this.cloner=void 0===s?e=>JSON.parse(JSON.stringify(e)):s}event(e){const n=t.Applied(this.$comparing,this.cloner);return t.All(n,this.$base).event(t.Transport((([t,n])=>{t&&e.use(Object.fromEntries(Object.entries(t).filter((([e,t])=>!!this.keep.includes(e)||!this.exclude.includes(e)&&t!==n[e]))))}))),this}use(e){return this.$comparing.use(e),this}}var u=Object.defineProperty,c=(e,t,n)=>((e,t,n)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class l{constructor(e,n){c(this,"$base"),c(this,"$keyed"),this.$base=t.SharedSource(e),this.$keyed=t.Shared(n)}event(e){return t.All(this.$base,this.$keyed).event(t.Transport((([t,n])=>{const r=n.split(".");let s=t;r.forEach((e=>{s=s[e]})),void 0!==s&&s!==t&&e.use(s)}))),this}use(e){const n=t.Primitive(this.$keyed);if(t.isFilled(n)){const r=t.Primitive(this.$base);this.$base.use({...r.primitiveWithException(),[n.primitiveWithException()]:e})}return this}}function a(e){return t.Event((n=>{const r=Object.keys(e);t.All(...Object.values(e)).event(t.Transport((e=>{const t={};e.forEach(((e,n)=>{t[r[n]]=e})),n.use(t)})))}))}var v=Object.defineProperty,p=(e,t,n)=>((e,t,n)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);class f{constructor(e=t.Of(""),n=t.Of({})){this.$src=e,this.$places=n,p(this,"dc",t.DestroyContainer()),p(this,"vars",{$TPL:t.Of("$TPL")})}event(e){const n=a(this.vars);return t.Applied(t.All(this.$src,this.$places,n),(([e,t,n])=>(Object.entries(t).forEach((([t,n])=>{e=e.replaceAll(t,String(n))})),Object.entries(n).forEach((([t,n])=>{e=e.replaceAll(t,String(n))})),e))).event(e),this}template(e){this.$src=t.Of(e)}var(e){const n=`$var${Object.keys(this.vars).length}`;return t.isDestroyable(e)&&this.dc.add(e),this.vars[n]=e,n}destroy(){return this.dc.destroy(),this}}function h(e,n,r=t.Of("")){return t.Event((s=>{t.All(e,n,r).event(t.Transport((([e,t,n])=>{s.use(new RegExp(e,n).test(t))})))}))}const d=t.TransportEvent((()=>t.Of(!1)));e.And=function(e,n){return t.Event((r=>{t.All(e,n).event(t.Transport((([e,t])=>{r.use(e&&t)})))}))},e.Bool=function(e){return t.Event((n=>{t.Applied(e,Boolean).event(n)}))},e.Branch=function(e,n,r){return t.Event((s=>{const i=t.Primitive(n);let o;void 0!==r&&(o=t.Primitive(r)),e.event(t.Transport((e=>{let t=null;e?t=i.primitive():o&&(t=o.primitive()),null!==t&&s.use(t)})))}))},e.BranchLazy=n,e.Concatenated=function(e,n=t.Of("")){return t.Event((r=>{t.All(n,...e).event(t.Transport((([e,...t])=>{r.use(t.join(e))})))}))},e.Constant=function(e,n){return t.Event((r=>{n.event(t.Transport((()=>{r.use(e)})))}))},e.Deadline=function(e,n,r){return t.Event((s=>{let i=0;const o=t.Shared(n,!0);r.event(t.Transport((n=>{i&&clearTimeout(i);let r=!1;i=setTimeout((()=>{r||(r=!0,e.use(new Error("Timeout reached in Deadline")))}),n);t.Filtered(o,(()=>!r)).event(s),o.event(t.Transport((()=>{r=!0})))})))}))},e.Deferred=function(e,n){return t.Event((r=>{const s=t.Primitive(e);n.event(t.Transport((()=>{const e=s.primitive();t.isFilled(e)&&r.use(e)})))}))},e.Detached=r,e.Dirty=function(e,t=[],n=[],r){return new o(e,t,n,r)},e.First=function(e){return t.Event((n=>{t.Applied(e,(e=>e[0])).event(n)}))},e.FromJson=function(e,n){return t.Event((r=>{e.event(t.Transport((e=>{try{r.use(JSON.parse(e))}catch(e){n?.use(new Error(`Failed to parse JSON: ${e}`))}})))}))},e.HashTable=function(e){return t.Event((n=>{const r={};e.event(t.Transport((([e,t])=>{r[e]=t,n.use(r)})))}))},e.Loading=function(e,n){return t.Event((r=>{e.event(t.Transport((()=>r.use(!0)))),n.event(t.Transport((()=>r.use(!1))))}))},e.Lock=function(e,n){return t.Event((r=>{let s=!1;n.event(t.Transport((e=>{s=e})));t.Filtered(e,(()=>!s)).event(r)}))},e.Memo=function(e){return t.Event((n=>{let r=null;e.event(t.Transport((e=>{e!==r&&t.isFilled(e)&&(n.use(e),r=e)})))}))},e.Not=function(e){return t.Event((n=>{e.event(t.Transport((e=>{n.use(!e)})))}))},e.OnlyChanged=function(e){return t.Event((n=>{let r=!1;e.event(t.Transport((e=>{!1===r?r=!0:n.use(e)})))}))},e.Or=function(e,n){return t.Event((r=>{t.All(e,n).event(t.Transport((([e,t])=>{r.use(e||t)})))}))},e.Part=function(e,t){return new l(e,t)},e.Path=function(e,n){return t.Event((r=>{t.All(e,n).event(t.Transport((([e,t])=>{const n=t.split(".");let s=e;n.forEach((e=>{s=s[e]})),void 0!==s&&s!==e&&r.use(s)})))}))},e.Polling=function(e,n){return t.Event((r=>{n.event(t.Transport((()=>{e.event(r)})))}))},e.RecordOf=a,e.RegexpMatch=function(e,n,r=t.Of("")){return t.Event((s=>{t.All(e,n,r).event(t.Transport((([e,t,n])=>{const r=new RegExp(e,n).exec(t);s.use(r??[])})))}))},e.RegexpMatched=h,e.RegexpReplaced=function(e,n,r,s=t.Of("")){return t.Event((i=>{t.All(n,e,r,s).event(t.Transport((([e,t,n,r])=>{i.use(String(t).replace(new RegExp(e,r),n))})))}))},e.Router=function(e,r,s){return t.Event((i=>{const o=[],u=()=>{o.forEach((e=>e.destroy())),o.length=0};return t.All(r,e).event(t.Transport((([e,r])=>{u();const c=t.All(s.use(),t.All(...e.map((e=>{const s=t.TransportDestroyable(e.event);return o.push(s),n(h(t.Of(e.pattern),t.Of(r),e.patternFlags?t.Of(e.patternFlags):void 0),s,d)}))));t.Applied(c,(e=>{const t=e[1].find((e=>!1!==e));return t||e[0]})).event(i)}))),u}))},e.Set=function(e,n,r){return t.Event((s=>{t.All(e,n,r).event(t.Transport((([e,t,n])=>{e[t]=n,s.use(e)})))}))},e.Shot=function(e,n){return t.Event((r=>{const s=t.Primitive(e);s.primitive(),n.event(t.Transport((()=>{const e=s.primitive();t.isFilled(e)&&r.use(e)})))}))},e.Task=function(e,n=0){return t.Event((r=>{let s=null;t.ExecutorApplied(e,(e=>t=>{s&&clearTimeout(s),s=setTimeout((()=>{e(t)}),n)})).event(r)}))},e.Template=function(e=t.Of(""),n=t.Of({})){return new f(e,n)},e.Tick=function(e){return t.Event((n=>{let r=!1,s=null;e.event(t.Transport((e=>{s=e,r||(r=!0,queueMicrotask((()=>{r=!1,null!==s&&(n.use(s),s=null)})))})))}))},e.ToJson=function(e,n){return t.Event((r=>{e.event(t.Transport((e=>{try{r.use(JSON.stringify(e))}catch{n?.use(new Error("Failed to convert to JSON"))}})))}))},e.Transaction=function(e,n,...s){return t.Event((i=>{const o=t.LateShared(),u=[];return e.event(t.Transport((e=>{const i=n(t.Of(e),...s.map((e=>r(e))));u.push(i),i.event(o)}))),o.event(i),()=>{u.forEach((e=>e?.destroy())),u.length=0}}))}}({},silentium);
