!function(t,e){"use strict";function n(t,e,n){return r=>{let i;return t((t=>{void 0!==i&&"function"==typeof i&&i();let o=null;t?o=e():n&&(o=n()),o&&(i=o(r))})),()=>{i?.()}}}function r(t){return function(n){const r=e.Primitive(t).primitive();e.isFilled(r)&&n(r)}}function i(t){return n=>{const r=Object.keys(t);e.All(...Object.values(t))((t=>{const e={};t.forEach(((t,n)=>{e[r[n]]=t})),n(e)}))}}function o(t,n,r=e.Of("")){return i=>{e.All(t,n,r)((([t,e,n])=>{i(new RegExp(t,n).test(e))}))}}const l=()=>e.Of(!1);t.And=function(t,n){return r=>{e.All(t,n)((([t,e])=>{r(t&&e)}))}},t.Bool=function(t){return n=>{e.Applied(t,Boolean)(n)}},t.Branch=function(t,n,r){return i=>{const o=e.Primitive(n);let l;void 0!==r&&(l=e.Primitive(r)),t((t=>{let e=null;t?e=o.primitive():l&&(e=l.primitive()),null!==e&&i(e)}))}},t.BranchLazy=n,t.Concatenated=function(t,n=e.Of("")){return r=>{e.All(n,...t)((([t,...e])=>{r(e.join(t))}))}},t.Constant=function(t,e){return n=>{e((()=>{n(t)}))}},t.Deadline=function(t,n,r){return i=>{let o=null;const l=e.Shared(n,!0);r((n=>{o&&clearTimeout(o);let r=!1;o=setTimeout((()=>{r||(r=!0,t(new Error("Timeout reached in Deadline class")))}),n);e.Filtered(l.event,(()=>!r))(i),l.event((()=>{r=!0}))}))}},t.Deferred=function(t,n){return r=>{const i=e.Primitive(t);n((()=>{const t=i.primitive();e.isFilled(t)&&r(t)}))}},t.Detached=r,t.Dirty=function(t,n=[],r=[],i){const o=e.Late();return void 0===i&&(i=t=>JSON.parse(JSON.stringify(t))),{event:l=>{const u=e.Applied(o.event,i);e.All(u,t)((([t,e])=>{t&&l(Object.fromEntries(Object.entries(t).filter((([t,i])=>!!n.includes(t)||!r.includes(t)&&i!==e[t]))))}))},use:t=>{o.use(t)}}},t.First=function(t){return n=>{e.Applied(t,(t=>t[0]))(n)}},t.FromJson=function(t,e){return n=>{t((t=>{try{n(JSON.parse(t))}catch(t){e?.(new Error(`Failed to parse JSON: ${t}`))}}))}},t.HashTable=function(t){return e=>{const n={};t((([t,r])=>{n[t]=r,e(n)}))}},t.Loading=function(t,e){return n=>{t((()=>n(!0))),e((()=>n(!1)))}},t.Lock=function(t,n){return r=>{let i=!1;n((t=>{i=t}));e.Filtered(t,(()=>!i))(r)}},t.Memo=function(t){return e=>{let n=null;t((t=>{t!==n&&(e(t),n=t)}))}},t.Not=function(t){return e=>{t((t=>{e(!t)}))}},t.OnlyChanged=function(t){return e=>{let n=!1;t((t=>{!1===n?n=!0:e(t)}))}},t.Or=function(t,n){return r=>{e.All(t,n)((([t,e])=>{r(t||e)}))}},t.Part=function(t,n){const r=e.Primitive(t.event),i=e.Primitive(n);return{event:r=>{e.All(t.event,n)((([t,e])=>{const n=e.split(".");let i=t;n.forEach((t=>{i=i[t]})),void 0!==i&&i!==t&&r(i)}))},use:n=>{const o=i.primitive();e.isFilled(o)&&t.use({...r.primitive(),[o]:n})}}},t.Path=function(t,n){return r=>{e.All(t,n)((([t,e])=>{const n=e.split(".");let i=t;n.forEach((t=>{i=i[t]})),void 0!==i&&i!==t&&r(i)}))}},t.Polling=function(t,e){return n=>{e((()=>{t(n)}))}},t.RecordOf=i,t.RegexpMatch=function(t,n,r=e.Of("")){return i=>{e.All(t,n,r)((([t,e,n])=>{const r=new RegExp(t,n).exec(e);i(r??[])}))}},t.RegexpMatched=o,t.RegexpReplaced=function(t,n,r,i=e.Of("")){return o=>{e.All(n,t,r,i)((([t,e,n,r])=>{o(String(e).replace(new RegExp(t,r),n))}))}},t.Router=function(t,r,i){return u=>{const c=[],s=()=>{c.forEach((t=>t())),c.length=0};return e.All(r,t)((([t,r])=>{s();const f=e.All(i(),e.All(...t.map((t=>e.Destructor(n(o(e.Of(t.pattern),e.Of(r),t.patternFlags?e.Of(t.patternFlags):void 0),t.template,l),(t=>c.push(t))).event))));e.Applied(f,(t=>{const e=t[1].find((t=>!1!==t));return e||t[0]}))(u)})),s}},t.Set=function(t,n,r){return i=>{e.All(t,n,r)((([t,e,n])=>{t[e]=n,i(t)}))}},t.Shot=function(t,n){return r=>{const i=e.Primitive(t);n((()=>{const t=i.primitive();e.isFilled(t)&&r(t)}))}},t.Task=function(t,n=0){return r=>{let i=null;e.ExecutorApplied(t,(t=>e=>{i&&clearTimeout(i),i=setTimeout((()=>{t(e)}),n)}))(r)}},t.Template=function(t=e.Of(""),n=e.Of({})){let r=0;const o={$TPL:e.Of("$TPL")},l=[];return{value:r=>{const l=i(o);e.Applied(e.All(t,n,l),(([t,e,n])=>(Object.entries(e).forEach((([e,n])=>{t=t.replaceAll(e,String(n))})),Object.entries(n).forEach((([e,n])=>{t=t.replaceAll(e,String(n))})),t)))(r)},template:n=>{t=e.Of(n)},var:t=>{const n=`$var${r}`;return r+=1,o[n]=e.Destructor(t,(t=>{l.push(t)})).event,n},destroy(){l.forEach((t=>t()))}}},t.Tick=function(t){return e=>{let n=!1,r=null;t((t=>{r=t,n||(n=!0,queueMicrotask((()=>{n=!1,null!==r&&(e(r),r=null)})))}))}},t.ToJson=function(t,e){return n=>{t((t=>{try{n(JSON.stringify(t))}catch{e?.(new Error("Failed to convert to JSON"))}}))}},t.Transaction=function(t,n,...i){return o=>{const l=e.LateShared(),u=[];return t((t=>{const o=e.Destructor(n(e.Of(t),...i.map((t=>r(t)))));u.push(o),o.event(l.use)})),l.event(o),()=>{u.forEach((t=>t.destroy())),u.length=0}}}}({},silentium);
