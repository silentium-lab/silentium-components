!function(t,e){"use strict";function n(t,e,n){return r=>{let i;return t((t=>{void 0!==i&&"function"==typeof i&&i();let l=null;t?l=e():n&&(l=n()),l&&(i=l(r))})),()=>{i?.()}}}function r(t){return n=>{const r=Object.keys(t);e.All(...Object.values(t))((t=>{const e={};t.forEach(((t,n)=>{e[r[n]]=t})),n(e)}))}}function i(t,n,r=e.Of("")){return i=>{e.All(t,n,r)((([t,e,n])=>{i(new RegExp(t,n).test(e))}))}}const l=()=>e.Of(!1);t.And=function(t,n){return r=>{e.All(t,n)((([t,e])=>{r(t&&e)}))}},t.Bool=function(t){return n=>{e.Applied(t,Boolean)(n)}},t.Branch=function(t,n,r){return i=>{const l=e.Primitive(n);let o;void 0!==r&&(o=e.Primitive(r)),t((t=>{let e=null;t?e=l.primitive():o&&(e=o.primitive()),null!==e&&i(e)}))}},t.BranchLazy=n,t.Concatenated=function(t,n=e.Of("")){return r=>{e.All(n,...t)((([t,...e])=>{r(e.join(t))}))}},t.Constant=function(t,e){return n=>{e((()=>{n(t)}))}},t.Deadline=function(t,n,r){return i=>{let l=null;const o=e.Shared(n,!0);r((n=>{l&&clearTimeout(l);let r=!1;l=setTimeout((()=>{r||(r=!0,t(new Error("Timeout reached in Deadline class")))}),n);e.Filtered(o.event,(()=>!r))(i),o.event((()=>{r=!0}))}))}},t.Deferred=function(t,n){return r=>{const i=e.Primitive(t);n((()=>{const t=i.primitive();e.isFilled(t)&&r(t)}))}},t.Detached=function(t){return function(n){const r=e.Primitive(t).primitive();e.isFilled(r)&&n(r)}},t.Dirty=function(t,n=[],r=[],i){const l=e.Late();return void 0===i&&(i=t=>JSON.parse(JSON.stringify(t))),{event:o=>{const u=e.Applied(l.event,i);e.All(u,t)((([t,e])=>{t&&o(Object.fromEntries(Object.entries(t).filter((([t,i])=>!!n.includes(t)||!r.includes(t)&&i!==e[t]))))}))},use:t=>{l.use(t)}}},t.First=function(t){return n=>{e.Applied(t,(t=>t[0]))(n)}},t.FromJson=function(t,e){return n=>{t((t=>{try{n(JSON.parse(t))}catch(t){e?.(new Error(`Failed to parse JSON: ${t}`))}}))}},t.HashTable=function(t){return e=>{const n={};t((([t,r])=>{n[t]=r,e(n)}))}},t.Loading=function(t,e){return n=>{t((()=>n(!0))),e((()=>n(!1)))}},t.Lock=function(t,n){return r=>{let i=!1;n((t=>{i=t}));e.Filtered(t,(()=>!i))(r)}},t.Memo=function(t){return e=>{let n=null;t((t=>{t!==n&&(e(t),n=t)}))}},t.Not=function(t){return e=>{t((t=>{e(!t)}))}},t.OnlyChanged=function(t){return e=>{let n=!1;t((t=>{!1===n?n=!0:e(t)}))}},t.Or=function(t,n){return r=>{e.All(t,n)((([t,e])=>{r(t||e)}))}},t.Part=function(t,n){const r=e.Primitive(t.event),i=e.Primitive(n);return{event:r=>{e.All(t.event,n)((([t,e])=>{const n=e.split(".");let i=t;n.forEach((t=>{i=i[t]})),void 0!==i&&i!==t&&r(i)}))},use:n=>{const l=i.primitive();e.isFilled(l)&&t.use({...r.primitive(),[l]:n})}}},t.Path=function(t,n){return r=>{e.All(t,n)((([t,e])=>{const n=e.split(".");let i=t;n.forEach((t=>{i=i[t]})),void 0!==i&&i!==t&&r(i)}))}},t.Polling=function(t,e){return n=>{e((()=>{t(n)}))}},t.RecordOf=r,t.RegexpMatch=function(t,n,r=e.Of("")){return i=>{e.All(t,n,r)((([t,e,n])=>{const r=new RegExp(t,n).exec(e);i(r??[])}))}},t.RegexpMatched=i,t.RegexpReplaced=function(t,n,r,i=e.Of("")){return l=>{e.All(n,t,r,i)((([t,e,n,r])=>{l(String(e).replace(new RegExp(t,r),n))}))}},t.Router=function(t,r,o){return u=>{const c=[],s=()=>{c.forEach((t=>t())),c.length=0};return e.All(r,t)((([t,r])=>{s();const f=e.All(o(),e.All(...t.map((t=>e.Destructor(n(i(e.Of(t.pattern),e.Of(r),t.patternFlags?e.Of(t.patternFlags):void 0),t.template,l),(t=>c.push(t))).event))));e.Applied(f,(t=>{const e=t[1].find((t=>!1!==t));return e||t[0]}))(u)})),s}},t.Set=function(t,n,r){return i=>{e.All(t,n,r)((([t,e,n])=>{t[e]=n,i(t)}))}},t.Shot=function(t,n){return r=>{const i=e.Primitive(t);n((()=>{const t=i.primitive();e.isFilled(t)&&r(t)}))}},t.Task=function(t,n=0){return r=>{let i=null;e.ExecutorApplied(t,(t=>e=>{i&&clearTimeout(i),i=setTimeout((()=>{t(e)}),n)}))(r)}},t.Template=function(t=e.Of(""),n=e.Of({})){let i=0;const l={$TPL:e.Of("$TPL")},o=[];return{value:i=>{const o=r(l);e.Applied(e.All(t,n,o),(([t,e,n])=>(Object.entries(e).forEach((([e,n])=>{t=t.replaceAll(e,String(n))})),Object.entries(n).forEach((([e,n])=>{t=t.replaceAll(e,String(n))})),t)))(i)},template:n=>{t=e.Of(n)},var:t=>{const n=`$var${i}`;return i+=1,l[n]=e.Destructor(t,(t=>{o.push(t)})).event,n},destroy(){o.forEach((t=>t()))}}},t.Tick=function(t){return e=>{let n=!1,r=null;t((t=>{r=t,n||(n=!0,queueMicrotask((()=>{n=!1,null!==r&&(e(r),r=null)})))}))}},t.ToJson=function(t,e){return n=>{t((t=>{try{n(JSON.stringify(t))}catch{e?.(new Error("Failed to convert to JSON"))}}))}}}({},silentium);
